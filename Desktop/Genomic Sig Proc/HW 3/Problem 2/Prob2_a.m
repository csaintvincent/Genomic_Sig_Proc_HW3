% We need to generate an initial (k x w) matrix Q which contains the
% probabilities for each symbol k to be in the b'th posiiton of the
% motif where 1 <= b <= w. We initialize them to be uniform (sum of the rows in a column is
% 1). This matrix will be updated.

% We will also need a (k x 1) matrix Q_0 which will be the porbabilities
% that a symbol will be outside the motif. This is uniform and well but
% will not be updated.

% We then need to calculte an (i x j) matrix Z which contains the
% probabilities that the i'th sequence motif will have the first element in
% the motif be from the j'th posiiton in that sequence.


% The i'th row will correspond to calculations done to the i

% seq_array = ['AACTTGTCTCGTC';
%              'CAGTAGGCTAGCT';
%              'CGATCGATATCGT'
%                             ];
                        
seq_array = importdata('data3.txt', ' ');
seq_array(cellfun('isempty',seq_array)) = [];
seq_array1 = ['AAAGTAGAAAACTTGAGCACTTATTTCCTGCGCATGTCATATGTTAATTTTCCTCAACTGCGCTGAATACGTCCTGTCAATTCAAATATATCACGTTGTGAGCAGCCCTGAAGAAGAAAACCTCAACAGCAGTATTACTATTACAATCAAACAACTTTAGTGCCGCGTGATACCGGGGGTTGAAGTGGGTGCATTGAGCCGTATTCTTCTTCCCCGTAAGAAAGTTGTGTATCCTTTTTACTGCGTTGTAATAGCTTCTGAAAACCTAAAAAATGAACGCTATGTAGCTCATATCCGTTTTGCATAAGTAAGAATAACTACTTGTGCAGGGTGCCGAAAGGGATGGAAAACCGCTGCAGCAACCCTTGTTACATACAGTCGGATCCATCTGACTTACTTTCCTTGCGTCTCCCTGCGCGATTTTGTTGGCCATTTTCCAGATCCTCTAGAATTTTTCAAGGGTCGAGCCGTAGGAGGATTCTCTCAGAAGGCAAAAACGCATCGAAAGCGTGCTTTGTAAGAATATTTGGTATGGCTAAAGTAAGCAAAGCCATATCCCGATCCCGATCCCGACTCTTATTCCGATCCCTTCCGCCACATCCTGCATGTTTATTCGAATACCAAATTAGCTCATCTTCGTTATTTCATCATCCCTTTCTGCTATGGCAAGGACAAGTTTTTTTCTAGCATCTCATCGAAAACTTTCCTCTCCCTAATTGGCCAAAGTTTTCATATTCATCATCAGTTAGAAAGTATAATATCAATCCCTTACCTCATTACAAGTTGTATCACACTAAAAAAATCATATATAAGTCTGTGAGAGTCTTCAATTATTTAGCGTAACACCTATTCACTTTCTAATCTTGTTTCTTGTTTTTACATTCTGCAATACAACACAACAACAAATATTAACTCAATTATTATTATTTATAATTACAAAAACAAAACAACAAGTTTGAGACTTTAATATCTTTTGATTACTAAAAACAACAAATTTCAA';
              'ACCTGTAACTATGTTGGCACAAACGAAAAAAGTTTTGAGCTTAAGCACGCCTGAAAAGAAAATGTCCAAGAGTGATCCGAATCACGACTCTGTAATTTTTTTGAATGATGAGCCTAAGGCAATTCAGAAAAAGATTAGAAAAGCTTTAACAGATTCCATTTCTGATAGGTTCTACTACGACCCTGTAGAAAGACCAGGCGTATCGAATTTAATTAACATTGTCAGTGGCATTCAAAGAAAATCGATTGAAGATGTCGTAGAAGATGTATCTCGTTTCAATAACTATAGGGATTTCAAAGATTATGTTTCAGAAGTGATAATTGAGGAATTGAAAGGCCCAAGAACAGAATTTGAGAAATATATCAACGAACCGACCTATTTGCATAGTGTCGTTGAATCTGGCATGCGCAAAGCGAGAGAAAAAGCAGCAAAAAACCTGGCCGACATTCATAAAATAATGGGCTTCTGACTGTCCCCGGCTTTAGGCTGCTGCAAACGCAATGTAAATAATAATACAGTTTAACTTGTACGTATCTTTGTTATTTCAGAATATGCAAGATTCCTCACTCGGCAGATCTCATCAATAAACGTTAGTATCTTGAAAAATACGCAGATGTTGGTACAGTCTCTTGCAGAGGGCCAGCACCGTTAGAATGTTGTGTTGCCACCGTCTGGCTCGAAAACAGGTCGATCTGTGTAAGTATTGTCCTGGGTGCAGTTATTTGTAGTAGCGATTTTCGCGGGCAGTGGAAAAGAACGGGTGCAGTGCGGCGATGAGTGCAATTAGCTGCCGAAGGGTTTGCACCGGTGATTCCGAGACCTTTTGCACACACTTGTATATATTTAGGGAAGTCACGGTAACTAATGGATTTCTTCTCAAATTTGAGACATATGGATTAGACTTTAATTCTGCCTGGTACTAAGCTACTTTTCAAAGGTATTTGAGATATTTCGTAAATTTTGCGGCCAAGGAGTTGAGGTGTTTAATACTTAAAACGAA';
              'GTGCAGACTAATGAAAAAGACCCCAGACCCATCTCCACCTTTTGCAAGCACGAAGAACGTAGGCATGTCAAACGAAGAACCGGAAAAAATGGTTAACGATCGAATTGTGGTGAAGGCCATCGAGCCAAAAGATGAGGAAGCCTGGAACAAACTGTGGAAGGAGTATCAGGGTTTCCAAAAAACGGTTATGCCTCCGGAAGTAGCCACCACTACCTTCGCAAGGTTTATAGACCCTACGGTCAAACTATGGGGTGCTCTAGCCTTTGACACCGAGACCGGCGATGCAATTGGCTTTGCACACTACCTGAACCATTTGACGTCGTGGCATGTCGAAGAAGTTGTCTACATGAATGACTTATATGTCACTGAACGCGCAAGAGTCAAAGGCGTAGGTAGAAAGCTCATAGAATTTGTATACAGCCGTGCCGATGAGCTCGGTACGCCTGCAGTGTACTGGGTTACAGACCATTACAATCACCGCGCACAGTTGCTGTACACCAAAGTGGCTTACAAGACAGATAAGGTTCTTTACAAGAGAAACGGATACTGAAACCGCTGTGTAATGTAGACTACTGTGTATAGAGATAACTCTAGCTTCTATAGGCTCACTTGCGAAGCTTTTTTCCCACTTTTTCCCAGTGAAATAGTTTCTTATTGGCTTTTCATAGTTTGTTCTCCGATTTAATCGCAAGCGCCGTACGGCGCAGGCACAGAATGACTTGCAGCTTAATCCAGGTGCATTTTAAGAAACTTATCTGCTGGGAAGACCCCGAAGTTCATCGTTTACAATGTGCCGTAAAGAACACATTTGAGGGTGCAATCTGGTTCGTCTTTTGCCATAATTAGTAGTGCTCATCCGTGATCCTTTAATTTACTTTTGTGATGCGATGATTTGCAGATACTATATAAGCAATGGACACCGTCCATCACCGATGAGGCTAGAACATCGTAGTGCTTTGTAAAAGAACTGTTAAAGACCCAGTACGAAAATTTTTCCATA';
              'AAGCCACTCGACAGCGTCTTCCAGTATAACGTTGACGAAGTCGTCGAAACCAACTAACGTGCCCTCGAACTCGCGGTTCGACTGCAGCACAATCAACACTTTCTGGTTAATTGTTTTATCTATGACTTCCAAAGGCAAAATCTCCGGTAGACTCATTTTGCGCGCTTCTGTGTATGCTTGTGAGTGCACGTGTATACGCTATGCTTGTTGTGAGACCATCTATCCGCCAAGGAAGCCTTTTTCGCTTTCTCTGTATTTTTTCTACTTCAATAAGAAAGCAAGTATTCTGTTTTGCTACCCGGATGCAAAGACAAAACCCGAGCATCCGGGTAATAAAAGAGCAGGGTCCGGCTGAAGGTGCCAAAAAAGACCAAAAAGGGCTATATTATCTCTCTCTTACGATTGCCTCTGGTTAAAAAATGAAATAGATAATAAAAGGGCAGCAAAGAAAAAAAAGAAGAATACAATATACGTATACGTTCTCAACAATTTTTCGTCCTGTTTTTTTCTTGACCACGGTCACTACTAACTCCTGAGACATCAGACCAACGTGTAGAAAAAAAGAAATCGGGTCCGGCACTGACACACGCTCTGCGCCAATCAACCAGGGCGCATCGAGCATTCTTTCCAGGCCAGGGTGCAGAAATACTATTATTAAGTGCGCGAATACTGCTGGTGCATTAAACGAGCGAGTACAGTGAGCCCGCCGCTGACTGCCGACTCACGCCAGGCCGCTATTTCCTTCCCCCGCCCGCGTAAGCCGTGCCGAGCACCGTCGCAGCAGTAAGAAGGTGCGCATTTCATTCTCTGCACAGCGTAGATGAATGCACCCGATTTCTAAGTTGGTGTTGCAAGGCCCGGTGGAAGCGATGGGCTGTAGTTCGACCTTGAGCTTTTAGTTATATAAAATGCTCAATGTGAGCAAAAAAATACATAACACGACGGATTGTACGTTGTCGAAATCTTCTCTCAGCAGGTCATCACACATATACTTCCCGCC';
              'CCAAACCTGAATCCTTAATTTACGGTACAGCGCCCGGTCATGTTCCCCGATTGCCTGTTTCAAAAACGATAGCAGCACGGAAATAACAATCACTGCTTCCAAGCACTCTCTGAACACAACGAAGAAAACGGCCACGTTAAACACTTTGTTAGGCATGGCGGGAAGTATATGTGTGATGACCTGCTGAGAGAAGATTTCGACAACGTACAATCCGTCGTGTTATGTATTTTTTTGCTCACATTGAGCATTTTATATAACTAAAAGCTCAAGGTCGAACTACAGCCCATCGCTTCCACCGGGCCTTGCAACACCAACTTAGAAATCGGGTGCATTCATCTACGCTGTGCAGAGAATGAAATGCGCACCTTCTTACTGCTGCGACGGTGCTCGGCACGGCTTACGCGGGCGGGGGAAGGAAATAGCGGCCTGGCGTGAGTCGGCAGTCAGCGGCGGGCTCACTGTACTCGCTCGTTTAATGCACCAGCAGTATTCGCGCACTTAATAATAGTATTTCTGCACCCTGGCCTGGAAAGAATGCTCGATGCGCCCTGGTTGATTGGCGCAGAGCGTGTGTCAGTGCCGGACCCGATTTCTTTTTTTCTACACGTTGGTCTGATGTCTCAGGAGTTAGTAGTGACCGTGGTCAAGAAAAAAACAGGACGAAAAATTGTTGAGAACGTATACGTATATTGTATTCTTCTTTTTTTTCTTTGCTGCCCTTTTATTATCTATTTCATTTTTTAACCAGAGGCAATCGTAAGAGAGAGATAATATAGCCCTTTTTGGTCTTTTTTGGCACCTTCAGCCGGACCCTGCTCTTTTATTACCCGGATGCTCGGGTTTTGTCTTTGCATCCGGGTAGCAAAACAGAATACTTGCTTTCTTATTGAAGTAGAAAAAATACAGAGAAAGCGAAAAAGGCTTCCTTGGCGGATAGATGGTCTCACAACAAGCATAGCGTATACACGTGCACTCACAAGCATACACAGAAGCGCGCAAA';
              'AAGGACAGAGAAATTCATATTAAGAGAGCTAGAACTCCAGGCCAAATGCAAAGAGGAGGTTTCAGAGGCAGAGGCGGTTTCAGAGGCAGAGGAGGTTTTAGAGGAGGTTTCAGAGGCGGCTACAGAGGAGGTTTCAGAGGCAGAGGGAACTTCAGAGGTAGAGGCGGCGCCAGAGGTGGTTTCAATGGACAAAAAAGGGAAAAGATTCCATTAGACCAAATGGAAAGATCAAAGGATACCTTATATATTAATAACGTCCCATTCAAAGCTACCAAAGAGGAGGTCGCTGAATTTTTCGGTACTGACGCCGACTCCATCTCTTTGCCAATGAGAAAAATGAGAGACCAACACACTGGTAGGATCTTCACATCCGATTCTGCTAATAGAGGTATGGCATTTGTCACTTTCAGTGGTGAAAACGTTGATATTGAAGCTAAAGCTGAAGAATTTAAAGGCAAGGTTTTCGGTGACAGGGAGTTAACTGTAGATGTTGCTGTTATTAGACCAGAAAATGATGAAGAAGAAATTGAGCAAGAAACTGGTTCTGAAGAAAAGCAAGAATAATTACTTCTTACCCACATCCCTATTTCTAACTTGAGTTTTTGCTAGAGTTTTGTATTTTTGTTCACCTTCCCTGCAAAAGAAATATGTGTATTTATATATGCGTGTATACCTATATATGATATGTAAAAATGAGACGCCCCTGTTTTATTTTCAAACACTTCCCCGTATAGTTTTTTGCAATGACACTACTTTAACTTCTTCGACATGATTTGCTTTAGCACTACGAAGGATTGCATCATAACGTTTCGAAAGGGGTGCACTTTTAAAAACCAGTAAGTGAGTGCCTCGTGAACTGCTATTTTCGTATTTTGAAAAAAAAAATAAAAAAAAACTCCCTTATATATATATATAAATATCTATGTACTAAATGTCAAATCGCTAGCTCTCACCTATATCTTATTCATGCTGCAACCTCAATGGTTCACTACCTCGGAGA';
              'ACAGAATTTCAAGAGTAGCTTTGCAGATAGCCATGTTGATGAGCAATACTTTGCGTACAAATACAACCTTTTGCAGACATCGTATATGGCCATGTGCACAGCTAATTTTTCTCACAATTGGTGCCAATTATATGTGGATATGAGATATCTAATAGAACGAGATGAAAAGCTGTATAGAATAAAAGAATTAACAAGGAACCTGCTGGAAACTAAACTGAACATGAAATATCGTATTGTCTGTCAACTAATCAGGCATCAATTGACCGAATTTCGTGAGAACGAGAGAAATCCATCGTGGGACGCCACCATTGAGAAACTGCTACCTTATATCTTGAAGGAAATTGTTCGTCCACTGCAGAAAATAAGAGGTGAAGAAGGTTCCCGTTACTTGTTGTCTTTCTTAAACTTTTTATATAACGATTGCGTGACAAAGGAAATATTAAAATGGCAGATTATCTCTGAGGTCAATTCCGAAAATTTGGGTGAGCTCGTATCTTTATTAGTGAACAACACCGATATACAATTATTAGCGAAGGAACCAAGTTACAAAAAGATGAGAGAAAAATTCGCCACTATGGGCAAGTTTCTACCATTACATTTAAAGGAGATTATGGAGATGTTTTACAATGGGGATTTTTATCTTTTTGCGACAGACGAACTAATCCAATGGATAGAGTTATTGTTTGCCGACACTCCCCTGCGAAGGAATGCCATTGATGATATTTACGAAATTAGAGGCACTGCTCTAGATGATTAAAAAATAATTAATCGTAGGATAGGTTACATGATCATTGCAATAGATGTACATCTTGTATTACGTATGCGTAAGTTGTCTTTTTTTCAGTTTTCTAATAAATTTCACGTGATGCGGTAGTTTTTTTTGGGGGTGCAAAGTTGGCACATCTTGTAGTGCATTTTTGAGCTTCTTAAATGACTTGAATCATCTTAAAACATTGCAGGATGAGATTTCCAACGACACAAGAGAGAACTAGCGCAAAAG';
              'TTCGTTATGCTGGACGCTCTCAAAACCCCCATGGCATTCACAGGTCTGATGGCCATCAGAGCAGGCCTTGCAAATCTCGTTATAACAGGAAGCATCAGGTTAAATATGTGTTATGTGTTGTGTTTTCCTTATTCAATTGTTATATGAAGGGATGTTCTTATGGATTTAAGAATAATCTCTGAACACAAATATATATGCGGAAGAGCGAAGGAAGAGAGCAGAAAAGGCTACAACGAAACCCTTTCATTTACTTATATAAATAGCCTGAGTCATTTTTCCTCTCAATTTTTGCATCATCATGATCATACATGCTTTTTTTTTCCTTCTCCATGGCTAATTGGGGTGCAACGCACCTTATCGCCTTTGACGGCCTTGGCTAAGCGGAGATAAAGCCTCCGAACTTCGGCCCCGAAGGGATTGGCGCGGATATACACGGAAATAGCTTGTCATTTTTCCTTCGGTTGATGTCCGCGGACCGAGAAGTGGTGTTTCCACATTACGTCTCAGTGATGCAATCATCATGGCACGGGCATTAATTAAGGTTAAGGAACCACTTCTCTACGCCATACTCCAAACAATAACAATATTAGACCTAGCCAATTGATACCCATGAGCGTGCAGTCATTGCCATGGATTATTCATCTCTTTTCGCTGTTCTCTTTCTTTTCAAGTTTGTCATCATCATGCCTTCACTTTTGCCTTTCCATCTTTCTTTTTGCTGCAAAATAAAGGGAAGAGGGGTAAAAACGCAAGGAAGAACAAGAAGAAGAGGGTAGTGCAAGAAAAAGAAAAGAAGAAAAAAAAAAAAAAGTAATCTTGATACCGTGAGCAAATAAGCTAACGGAAAGCGTAAGAAAGAAGAGCGTGTTTTGGGAAATAACACCACAGCATAAAGCTAAAATTCAGTTTATATAATCTATAGTAGTCCTATAGAAATTGCGAATAACGGAAACAATAGTCCACCAAAGCAAGCATAGGGAGTGGAGATAGCATCTAGGTT'
              ];
                    
 seq_array2 = [
 'AAAGTAGAAAACTTGAGCACTTATTTCCTGCGCATGTCATATGTTAATTTTCCTCAACTGCGCTGAATACGTCCTGTCAATTCAAA';
 'AAGCCACTCGACAGCGTCTTCCAGTATAACGTTGACGAAGTCGTCGAAACCAACTAACGTGCCCTCGAACTCGCGGTTCGACTGCA';
 'TTCGTTATGCTGGACGCTCTCAAAACCCCCATGGCATTCACAGGTCTGATGGCCATCAGAGCAGGCCTTGCAAATCTCGTTATAAC'
 ];
 Q = 0.25*ones(4,7);
 Q_0 = 0.25*ones(4,1);
 Q1 = [0.24 0.24 0.24 0.28 0.24 0.24 0.24;
       0.28 0.24 0.28 0.24 0.24 0.24 0.24;
       0.24 0.28 0.24 0.24 0.24 0.28 0.28;
       0.24 0.24 0.24 0.24 0.28 0.24 0.24];
 
%  z = z_ij(Q,Q_0,seq_array1);
%  z1 = z_ij(Q1,Q_0,seq_array1);
%  
%  q1 = Q_estimate(seq_array1, z, 7);
%  q2 = Q_estimate(seq_array1, z1, 7);
%  
%  z11 = z_ij(q1,Q_0,seq_array2);

[q_t, z_t] = update_Q_z(Q,Q_0,8,seq_array1,7);
[q_t1, z_t1] = update_Q_z(Q1,Q_0,8,seq_array1,7);

%[q_t, z_t] = update_Q_z(Q,Q_0,10,seq_array2,7);
%[q_t1, z_t1] = update_Q_z(Q1,Q_0,10,seq_array2,7);
 
index1 = find(max(z_t(1,:)) == z_t(1,:));
index2 = find(max(z_t(2,:)) == z_t(2,:));
index3 = find(max(z_t(3,:)) == z_t(3,:));
index4 = find(max(z_t(4,:)) == z_t(4,:));
index5 = find(max(z_t(5,:)) == z_t(5,:));
index6 = find(max(z_t(6,:)) == z_t(6,:));
index7 = find(max(z_t(7,:)) == z_t(7,:));
index8 = find(max(z_t(8,:)) == z_t(8,:));

seqqq = [seq_array1(1,index1:(index1 + 6)); seq_array1(2,index2:(index2 + 6)); seq_array1(3,index3:(index3 + 6)); seq_array1(4,index4:(index4 + 6)); seq_array1(5,index5:(index5 + 6)); seq_array1(6,index6:(index6 + 6)); seq_array1(7,index7:(index7 + 6)); seq_array1(8,index8:(index8 + 6))];
%seqqq = [seq_array2(1,index1:(index1 + 6)); seq_array2(2,index2:(index2 + 6)); seq_array2(3,index3:(index3 + 6))];


% now we need to re-estimate Q. Q_0 will be the same.
