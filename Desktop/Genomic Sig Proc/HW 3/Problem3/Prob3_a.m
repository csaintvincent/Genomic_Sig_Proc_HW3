% We need to generate an initial (k x w) matrix Q which contains the
% probabilities for each symbol k to be in the b'th posiiton of the
% motif where 1 <= b <= w. We initialize them to be uniform (sum of the rows in a column is
% 1). This matrix will be updated.

% We will also need a (k x 1) matrix Q_0 which will be the porbabilities
% that a symbol will be outside the motif. This is uniform and well but
% will not be updated.

% We then need to calculte an (i x j) matrix Z which contains the
% probabilities that the i'th sequence motif will have the first element in
% the motif be from the j'th posiiton in that sequence.


% The i'th row will correspond to calculations done to the i

% seq_array = ['AACTTGTCTCGTC';
%              'CAGTAGGCTAGCT';
%              'CGATCGATATCGT'
%                             ];
                        
%seq_array = importdata('data3.txt', ' ');
%seq_array(cellfun('isempty',seq_array)) = [];
seq_array1 = ['AAAGTAGAAAACTTGAGCACTTATTTCCTGCGCATGTCATATGTTAATTTTCCTCAACTGCGCTGAATACGTCCTGTCAATTCAAATATATCACGTTGTGAGCAGCCCTGAAGAAGAAAACCTCAACAGCAGTATTACTATTACAATCAAACAACTTTAGTGCCGCGTGATACCGGGGGTTGAAGTGGGTGCATTGAGCCGTATTCTTCTTCCCCGTAAGAAAGTTGTGTATCCTTTTTACTGCGTTGTAATAGCTTCTGAAAACCTAAAAAATGAACGCTATGTAGCTCATATCCGTTTTGCATAAGTAAGAATAACTACTTGTGCAGGGTGCCGAAAGGGATGGAAAACCGCTGCAGCAACCCTTGTTACATACAGTCGGATCCATCTGACTTACTTTCCTTGCGTCTCCCTGCGCGATTTTGTTGGCCATTTTCCAGATCCTCTAGAATTTTTCAAGGGTCGAGCCGTAGGAGGATTCTCTCAGAAGGCAAAAACGCATCGAAAGCGTGCTTTGTAAGAATATTTGGTATGGCTAAAGTAAGCAAAGCCATATCCCGATCCCGATCCCGACTCTTATTCCGATCCCTTCCGCCACATCCTGCATGTTTATTCGAATACCAAATTAGCTCATCTTCGTTATTTCATCATCCCTTTCTGCTATGGCAAGGACAAGTTTTTTTCTAGCATCTCATCGAAAACTTTCCTCTCCCTAATTGGCCAAAGTTTTCATATTCATCATCAGTTAGAAAGTATAATATCAATCCCTTACCTCATTACAAGTTGTATCACACTAAAAAAATCATATATAAGTCTGTGAGAGTCTTCAATTATTTAGCGTAACACCTATTCACTTTCTAATCTTGTTTCTTGTTTTTACATTCTGCAATACAACACAACAACAAATATTAACTCAATTATTATTATTTATAATTACAAAAACAAAACAACAAGTTTGAGACTTTAATATCTTTTGATTACTAAAAACAACAAATTTCAA';
              'ACCTGTAACTATGTTGGCACAAACGAAAAAAGTTTTGAGCTTAAGCACGCCTGAAAAGAAAATGTCCAAGAGTGATCCGAATCACGACTCTGTAATTTTTTTGAATGATGAGCCTAAGGCAATTCAGAAAAAGATTAGAAAAGCTTTAACAGATTCCATTTCTGATAGGTTCTACTACGACCCTGTAGAAAGACCAGGCGTATCGAATTTAATTAACATTGTCAGTGGCATTCAAAGAAAATCGATTGAAGATGTCGTAGAAGATGTATCTCGTTTCAATAACTATAGGGATTTCAAAGATTATGTTTCAGAAGTGATAATTGAGGAATTGAAAGGCCCAAGAACAGAATTTGAGAAATATATCAACGAACCGACCTATTTGCATAGTGTCGTTGAATCTGGCATGCGCAAAGCGAGAGAAAAAGCAGCAAAAAACCTGGCCGACATTCATAAAATAATGGGCTTCTGACTGTCCCCGGCTTTAGGCTGCTGCAAACGCAATGTAAATAATAATACAGTTTAACTTGTACGTATCTTTGTTATTTCAGAATATGCAAGATTCCTCACTCGGCAGATCTCATCAATAAACGTTAGTATCTTGAAAAATACGCAGATGTTGGTACAGTCTCTTGCAGAGGGCCAGCACCGTTAGAATGTTGTGTTGCCACCGTCTGGCTCGAAAACAGGTCGATCTGTGTAAGTATTGTCCTGGGTGCAGTTATTTGTAGTAGCGATTTTCGCGGGCAGTGGAAAAGAACGGGTGCAGTGCGGCGATGAGTGCAATTAGCTGCCGAAGGGTTTGCACCGGTGATTCCGAGACCTTTTGCACACACTTGTATATATTTAGGGAAGTCACGGTAACTAATGGATTTCTTCTCAAATTTGAGACATATGGATTAGACTTTAATTCTGCCTGGTACTAAGCTACTTTTCAAAGGTATTTGAGATATTTCGTAAATTTTGCGGCCAAGGAGTTGAGGTGTTTAATACTTAAAACGAA';
              'GTGCAGACTAATGAAAAAGACCCCAGACCCATCTCCACCTTTTGCAAGCACGAAGAACGTAGGCATGTCAAACGAAGAACCGGAAAAAATGGTTAACGATCGAATTGTGGTGAAGGCCATCGAGCCAAAAGATGAGGAAGCCTGGAACAAACTGTGGAAGGAGTATCAGGGTTTCCAAAAAACGGTTATGCCTCCGGAAGTAGCCACCACTACCTTCGCAAGGTTTATAGACCCTACGGTCAAACTATGGGGTGCTCTAGCCTTTGACACCGAGACCGGCGATGCAATTGGCTTTGCACACTACCTGAACCATTTGACGTCGTGGCATGTCGAAGAAGTTGTCTACATGAATGACTTATATGTCACTGAACGCGCAAGAGTCAAAGGCGTAGGTAGAAAGCTCATAGAATTTGTATACAGCCGTGCCGATGAGCTCGGTACGCCTGCAGTGTACTGGGTTACAGACCATTACAATCACCGCGCACAGTTGCTGTACACCAAAGTGGCTTACAAGACAGATAAGGTTCTTTACAAGAGAAACGGATACTGAAACCGCTGTGTAATGTAGACTACTGTGTATAGAGATAACTCTAGCTTCTATAGGCTCACTTGCGAAGCTTTTTTCCCACTTTTTCCCAGTGAAATAGTTTCTTATTGGCTTTTCATAGTTTGTTCTCCGATTTAATCGCAAGCGCCGTACGGCGCAGGCACAGAATGACTTGCAGCTTAATCCAGGTGCATTTTAAGAAACTTATCTGCTGGGAAGACCCCGAAGTTCATCGTTTACAATGTGCCGTAAAGAACACATTTGAGGGTGCAATCTGGTTCGTCTTTTGCCATAATTAGTAGTGCTCATCCGTGATCCTTTAATTTACTTTTGTGATGCGATGATTTGCAGATACTATATAAGCAATGGACACCGTCCATCACCGATGAGGCTAGAACATCGTAGTGCTTTGTAAAAGAACTGTTAAAGACCCAGTACGAAAATTTTTCCATA';
              'AAGCCACTCGACAGCGTCTTCCAGTATAACGTTGACGAAGTCGTCGAAACCAACTAACGTGCCCTCGAACTCGCGGTTCGACTGCAGCACAATCAACACTTTCTGGTTAATTGTTTTATCTATGACTTCCAAAGGCAAAATCTCCGGTAGACTCATTTTGCGCGCTTCTGTGTATGCTTGTGAGTGCACGTGTATACGCTATGCTTGTTGTGAGACCATCTATCCGCCAAGGAAGCCTTTTTCGCTTTCTCTGTATTTTTTCTACTTCAATAAGAAAGCAAGTATTCTGTTTTGCTACCCGGATGCAAAGACAAAACCCGAGCATCCGGGTAATAAAAGAGCAGGGTCCGGCTGAAGGTGCCAAAAAAGACCAAAAAGGGCTATATTATCTCTCTCTTACGATTGCCTCTGGTTAAAAAATGAAATAGATAATAAAAGGGCAGCAAAGAAAAAAAAGAAGAATACAATATACGTATACGTTCTCAACAATTTTTCGTCCTGTTTTTTTCTTGACCACGGTCACTACTAACTCCTGAGACATCAGACCAACGTGTAGAAAAAAAGAAATCGGGTCCGGCACTGACACACGCTCTGCGCCAATCAACCAGGGCGCATCGAGCATTCTTTCCAGGCCAGGGTGCAGAAATACTATTATTAAGTGCGCGAATACTGCTGGTGCATTAAACGAGCGAGTACAGTGAGCCCGCCGCTGACTGCCGACTCACGCCAGGCCGCTATTTCCTTCCCCCGCCCGCGTAAGCCGTGCCGAGCACCGTCGCAGCAGTAAGAAGGTGCGCATTTCATTCTCTGCACAGCGTAGATGAATGCACCCGATTTCTAAGTTGGTGTTGCAAGGCCCGGTGGAAGCGATGGGCTGTAGTTCGACCTTGAGCTTTTAGTTATATAAAATGCTCAATGTGAGCAAAAAAATACATAACACGACGGATTGTACGTTGTCGAAATCTTCTCTCAGCAGGTCATCACACATATACTTCCCGCC';
              'CCAAACCTGAATCCTTAATTTACGGTACAGCGCCCGGTCATGTTCCCCGATTGCCTGTTTCAAAAACGATAGCAGCACGGAAATAACAATCACTGCTTCCAAGCACTCTCTGAACACAACGAAGAAAACGGCCACGTTAAACACTTTGTTAGGCATGGCGGGAAGTATATGTGTGATGACCTGCTGAGAGAAGATTTCGACAACGTACAATCCGTCGTGTTATGTATTTTTTTGCTCACATTGAGCATTTTATATAACTAAAAGCTCAAGGTCGAACTACAGCCCATCGCTTCCACCGGGCCTTGCAACACCAACTTAGAAATCGGGTGCATTCATCTACGCTGTGCAGAGAATGAAATGCGCACCTTCTTACTGCTGCGACGGTGCTCGGCACGGCTTACGCGGGCGGGGGAAGGAAATAGCGGCCTGGCGTGAGTCGGCAGTCAGCGGCGGGCTCACTGTACTCGCTCGTTTAATGCACCAGCAGTATTCGCGCACTTAATAATAGTATTTCTGCACCCTGGCCTGGAAAGAATGCTCGATGCGCCCTGGTTGATTGGCGCAGAGCGTGTGTCAGTGCCGGACCCGATTTCTTTTTTTCTACACGTTGGTCTGATGTCTCAGGAGTTAGTAGTGACCGTGGTCAAGAAAAAAACAGGACGAAAAATTGTTGAGAACGTATACGTATATTGTATTCTTCTTTTTTTTCTTTGCTGCCCTTTTATTATCTATTTCATTTTTTAACCAGAGGCAATCGTAAGAGAGAGATAATATAGCCCTTTTTGGTCTTTTTTGGCACCTTCAGCCGGACCCTGCTCTTTTATTACCCGGATGCTCGGGTTTTGTCTTTGCATCCGGGTAGCAAAACAGAATACTTGCTTTCTTATTGAAGTAGAAAAAATACAGAGAAAGCGAAAAAGGCTTCCTTGGCGGATAGATGGTCTCACAACAAGCATAGCGTATACACGTGCACTCACAAGCATACACAGAAGCGCGCAAA';
              'AAGGACAGAGAAATTCATATTAAGAGAGCTAGAACTCCAGGCCAAATGCAAAGAGGAGGTTTCAGAGGCAGAGGCGGTTTCAGAGGCAGAGGAGGTTTTAGAGGAGGTTTCAGAGGCGGCTACAGAGGAGGTTTCAGAGGCAGAGGGAACTTCAGAGGTAGAGGCGGCGCCAGAGGTGGTTTCAATGGACAAAAAAGGGAAAAGATTCCATTAGACCAAATGGAAAGATCAAAGGATACCTTATATATTAATAACGTCCCATTCAAAGCTACCAAAGAGGAGGTCGCTGAATTTTTCGGTACTGACGCCGACTCCATCTCTTTGCCAATGAGAAAAATGAGAGACCAACACACTGGTAGGATCTTCACATCCGATTCTGCTAATAGAGGTATGGCATTTGTCACTTTCAGTGGTGAAAACGTTGATATTGAAGCTAAAGCTGAAGAATTTAAAGGCAAGGTTTTCGGTGACAGGGAGTTAACTGTAGATGTTGCTGTTATTAGACCAGAAAATGATGAAGAAGAAATTGAGCAAGAAACTGGTTCTGAAGAAAAGCAAGAATAATTACTTCTTACCCACATCCCTATTTCTAACTTGAGTTTTTGCTAGAGTTTTGTATTTTTGTTCACCTTCCCTGCAAAAGAAATATGTGTATTTATATATGCGTGTATACCTATATATGATATGTAAAAATGAGACGCCCCTGTTTTATTTTCAAACACTTCCCCGTATAGTTTTTTGCAATGACACTACTTTAACTTCTTCGACATGATTTGCTTTAGCACTACGAAGGATTGCATCATAACGTTTCGAAAGGGGTGCACTTTTAAAAACCAGTAAGTGAGTGCCTCGTGAACTGCTATTTTCGTATTTTGAAAAAAAAAATAAAAAAAAACTCCCTTATATATATATATAAATATCTATGTACTAAATGTCAAATCGCTAGCTCTCACCTATATCTTATTCATGCTGCAACCTCAATGGTTCACTACCTCGGAGA';
              'ACAGAATTTCAAGAGTAGCTTTGCAGATAGCCATGTTGATGAGCAATACTTTGCGTACAAATACAACCTTTTGCAGACATCGTATATGGCCATGTGCACAGCTAATTTTTCTCACAATTGGTGCCAATTATATGTGGATATGAGATATCTAATAGAACGAGATGAAAAGCTGTATAGAATAAAAGAATTAACAAGGAACCTGCTGGAAACTAAACTGAACATGAAATATCGTATTGTCTGTCAACTAATCAGGCATCAATTGACCGAATTTCGTGAGAACGAGAGAAATCCATCGTGGGACGCCACCATTGAGAAACTGCTACCTTATATCTTGAAGGAAATTGTTCGTCCACTGCAGAAAATAAGAGGTGAAGAAGGTTCCCGTTACTTGTTGTCTTTCTTAAACTTTTTATATAACGATTGCGTGACAAAGGAAATATTAAAATGGCAGATTATCTCTGAGGTCAATTCCGAAAATTTGGGTGAGCTCGTATCTTTATTAGTGAACAACACCGATATACAATTATTAGCGAAGGAACCAAGTTACAAAAAGATGAGAGAAAAATTCGCCACTATGGGCAAGTTTCTACCATTACATTTAAAGGAGATTATGGAGATGTTTTACAATGGGGATTTTTATCTTTTTGCGACAGACGAACTAATCCAATGGATAGAGTTATTGTTTGCCGACACTCCCCTGCGAAGGAATGCCATTGATGATATTTACGAAATTAGAGGCACTGCTCTAGATGATTAAAAAATAATTAATCGTAGGATAGGTTACATGATCATTGCAATAGATGTACATCTTGTATTACGTATGCGTAAGTTGTCTTTTTTTCAGTTTTCTAATAAATTTCACGTGATGCGGTAGTTTTTTTTGGGGGTGCAAAGTTGGCACATCTTGTAGTGCATTTTTGAGCTTCTTAAATGACTTGAATCATCTTAAAACATTGCAGGATGAGATTTCCAACGACACAAGAGAGAACTAGCGCAAAAG';
              'TTCGTTATGCTGGACGCTCTCAAAACCCCCATGGCATTCACAGGTCTGATGGCCATCAGAGCAGGCCTTGCAAATCTCGTTATAACAGGAAGCATCAGGTTAAATATGTGTTATGTGTTGTGTTTTCCTTATTCAATTGTTATATGAAGGGATGTTCTTATGGATTTAAGAATAATCTCTGAACACAAATATATATGCGGAAGAGCGAAGGAAGAGAGCAGAAAAGGCTACAACGAAACCCTTTCATTTACTTATATAAATAGCCTGAGTCATTTTTCCTCTCAATTTTTGCATCATCATGATCATACATGCTTTTTTTTTCCTTCTCCATGGCTAATTGGGGTGCAACGCACCTTATCGCCTTTGACGGCCTTGGCTAAGCGGAGATAAAGCCTCCGAACTTCGGCCCCGAAGGGATTGGCGCGGATATACACGGAAATAGCTTGTCATTTTTCCTTCGGTTGATGTCCGCGGACCGAGAAGTGGTGTTTCCACATTACGTCTCAGTGATGCAATCATCATGGCACGGGCATTAATTAAGGTTAAGGAACCACTTCTCTACGCCATACTCCAAACAATAACAATATTAGACCTAGCCAATTGATACCCATGAGCGTGCAGTCATTGCCATGGATTATTCATCTCTTTTCGCTGTTCTCTTTCTTTTCAAGTTTGTCATCATCATGCCTTCACTTTTGCCTTTCCATCTTTCTTTTTGCTGCAAAATAAAGGGAAGAGGGGTAAAAACGCAAGGAAGAACAAGAAGAAGAGGGTAGTGCAAGAAAAAGAAAAGAAGAAAAAAAAAAAAAAGTAATCTTGATACCGTGAGCAAATAAGCTAACGGAAAGCGTAAGAAAGAAGAGCGTGTTTTGGGAAATAACACCACAGCATAAAGCTAAAATTCAGTTTATATAATCTATAGTAGTCCTATAGAAATTGCGAATAACGGAAACAATAGTCCACCAAAGCAAGCATAGGGAGTGGAGATAGCATCTAGGTT'
              ];
                    
 seq_array2 = [
 'AAATTAACCGGTAGAAAACTTGAGCACTTAACCGTTATTTCCTGCGCATGTCATATGTTAATTAACCGTTTTCCTCAACTGCGCTGAATTTAACCGACGTCCTGTCAATTCAAA';
 'AAGCCACTTTAACCGTTAACCGCGACAGCGTCTTCCAGTATTTAACCGAACGTTGACGAAGTCGTCGAAACCAACTAACGTGCCCTTTAACCGCGAACTCGCGGTTCGACTGCA';
 'TTAACCGTTCGTTATGCTTTAACCGGGACGCTCTCAAAACCCCCATGGCATTCACAGGTCTGATTAACCGTGGCCATCAGAGCAGGCCTTGCAAATCTCGTTTTAACCGATAAC'
 ];


 Q = 0.25*ones(4,7);
 Q_0 = 0.25*ones(4,1);
 Q1 = [0.24 0.24 0.24 0.28 0.24 0.24 0.24;
       0.28 0.24 0.28 0.24 0.24 0.24 0.24;
       0.24 0.28 0.24 0.24 0.24 0.28 0.28;
       0.24 0.24 0.24 0.24 0.28 0.24 0.24];
 
%  z = z_ij(Q,Q_0,seq_array1);
%  z1 = z_ij(Q1,Q_0,seq_array1);
%  
%  q1 = Q_estimate(seq_array1, z, 7);
%  q2 = Q_estimate(seq_array1, z1, 7);
%  
%  z11 = z_ij(q1,Q_0,seq_array2);
tic
[q_t, z_t] = update_Q_z(Q,Q_0,10,seq_array1,7);
toc
[q_t1, z_t1] = update_Q_z(Q1,Q_0,10,seq_array1,7);

tic
[q_t3, z_t3] = update_Q_z(Q,Q_0,10,seq_array2,7);
toc
[q_t13, z_t13] = update_Q_z(Q1,Q_0,10,seq_array2,7);


%[q_t, z_t] = update_Q_z(Q,Q_0,10,seq_array2,7);
%[q_t1, z_t1] = update_Q_z(Q1,Q_0,10,seq_array2,7);
 
% index1 = find(max(z_t(1,:)) == z_t(1,:));
% index2 = find(max(z_t(2,:)) == z_t(2,:));
% index3 = find(max(z_t(3,:)) == z_t(3,:));
% index4 = find(max(z_t(4,:)) == z_t(4,:));
% index5 = find(max(z_t(5,:)) == z_t(5,:));
% index6 = find(max(z_t(6,:)) == z_t(6,:));
% index7 = find(max(z_t(7,:)) == z_t(7,:));
% index8 = find(max(z_t(8,:)) == z_t(8,:));


s1q = string_EM(seq_array1, z_t, 7, 3);
s1q1 = string_EM(seq_array1, z_t1, 7,3);

s2q = string_EM(seq_array2, z_t3, 7, 3);
s2q1 = string_EM(seq_array2, z_t13, 7, 3);
%TTAACCG was implanted

% now we need to re-estimate Q. Q_0 will be the same.
